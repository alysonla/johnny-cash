<html>
  <head>
<meta property="fb:admins" content="714655333" />
<meta property="og:title" content="Johnny Cash Has Been Everywhere (Man)!" />
<meta property="og:image" content="http://iainmullan.com/johnny-cash/screenshot.jpg" />

<meta property="og:url" content="http://iainmullan.com/johnny-cash/" />
<meta property="og:type" content="website" />

	<title>Johnny Cash Has Been Everywhere (Man)! - Music Hack Day London 2012 - Iain Mullan</title>

    <script src="jquery.min.js"></script>
    <script src="lyrics.js"></script>

	 <script
	    src='http://maps.google.com/maps/api/js?sensor=false'
	    type='text/javascript'></script>

	<style type="text/css">
			body {
				padding: 0;
				margin: 0;
				font-family: Arial;
			}
			#map {
				width: 100%; height:100%;
				position:absolute;
				top: 0;
				z-index: 1;
			}

			.panel {
				padding: 5px;
				background-color: rgba(0,0,0,0.6);
				color: white;
				z-index: 2;
				position:relative;
			}

			#overlay {
				text-align:center;
				width: 90%;
				margin: 10px auto;
			}

			#subtitle {
				font-size: 36px;
			}

			.place-lyric {
				text-transform: uppercase;
				color: #5c5;
			}

			#progress {
				background-color: #595;
				height: 5px;
				width: 0%;
			}

			#time {
				float:right;
			}

			#finger {
				position:absolute;
				top: 120px;
				text-align:center;
				display: none;
				z-index: 3;
				width: 100%;
			}

			#distance {
				position: absolute;
				bottom: 10%;
				left: 5%;
				z-index: 5;
				font-size: 24px;
			}
			#credits {
				position: absolute;
				bottom: 10%;
				right: 5%;
				font-size: 12px;
			}
			#credits a {
				color: white;
			}
			#distance-num {
				font-size: 36px;
				margin-left: 10px;
			}
			#controls {
				float:left;
				display:none;
			}
		</style>
</head>
<body>
	<div id="fb-root"></div>


	<div id="overlay" class="panel">
		<h2 id="subtitle">Johnny Cash Has Been EVERYWHERE (Man)!</h2>

		<div id="progress"></div>
		<div id="time"></div>

		<div id="player" style="display:none;"></div>

		<div id="controls" class="panel">
			<button id="play">Play</button>
			<button id="pause">Pause</button>
			<button id="skip">Hurry up!</button>
			<button id="end">Skip to End</button>
			<!-- <button id="load">Load</button> -->
		</div>

	</div>

	<div id="distance" class="panel">Distance travelled:<span id="distance-num">0</span> km</div>

	<div id="credits" class="panel">
		a hack by <a href="http://www.iainmullan.com" target="_blank">Iain Mullan</a>
			for
			<a href="http://london.musichackday.org/2012/" target="_blank">Music Hack Day London 2012</a>
			using
			<a href="http://developer.musixmatch.com" target="_blank">MusixMatch</a>
			,
			<a href="http://toma.hk" target="_blank">Toma.HK</a>
			and
			<a href="http://www.coversfm.com/artist/83" target="_blank">Johnny Cash</a>

			<div id="social" style="margin-top: 3px">
				<div class="fb-like" data-href="http://iainmullan.com/johnny-cash/" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false"></div>
				<div style="display:inline; margin-top: 5px;"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://iainmullan.com/johnny-cash/" data-related="iainmullan">Tweet</a></div>

			</div>


	</div>

	<div id="finger"><img src="finger.png" /></div>

	<div id='map' style=""></div>


	<script src="http://toma.hk/api.js?v=1"></script>


<script type="text/javascript">

	if (typeof(Number.prototype.toRad) === "undefined") {
	  Number.prototype.toRad = function() {
	    return this * Math.PI / 180;
	  }
	}

	function log(s){console.log(s)}

	$(document).ready(function() {

		var track;
		var lastPin = false;

		function loadTrack(MM) {

//			console.log(tomahkAPI);

			track = window.tomahkAPI.Track("I've Been Everywhere","Johnny Cash", {
				width: 300,
				height: 300,
				handlers: {
			       onloaded: function() {
			        },
			        onended: function() {
						$('#finger').show();
			        },
			        onplayable: function() {
						$('#controls').show();
						track.play();
			        },
			        onresolved: function(resolver, result) {
			            console.log(":\n  Track found: "+resolver+" - "+ result.track + " by "+result.artist);
			        },
			        ontimeupdate: function(timeupdate) {
			            var t = timeupdate.currentTime;
						t = t*1000;
						t = parseInt(t);
						$('#time').html(t);

						var pct = (timeupdate.currentTime / timeupdate.duration) * 100;
						pct = parseInt(pct);
						$('#progress').css('width', pct+'%');

						var newLyric = MM.getNextLyric(t);
						if (newLyric) {
							$('#subtitle').html(newLyric.lyric);

							$('#subtitle').removeClass('place-lyric');

							if (MM.places[newLyric.lyric]) {

								$('#subtitle').addClass('place-lyric');

								var place = MM.places[newLyric.lyric];

								latLng = new google.maps.LatLng(place.lat, place.lng);

								var marker = new google.maps.Marker({
							        position: latLng,
							        map: map,
									animation: google.maps.Animation.DROP,
							        title:place.name,
									icon: 'face-small.png'
							    });

								if (lastPin) {

//									console.log(lastPin);

									var lat1 = lastPin.position.lat();
									var lon1 = lastPin.position.lng();
									var lat2 = marker.position.lat();
									var lon2 = marker.position.lng();

									var R = 6371; // km
									var dLat = (lat2-lat1).toRad();
									var dLon = (lon2-lon1).toRad();
									var lat1 = lat1.toRad();
									var lat2 = lat2.toRad();

									var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
									        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2);
									var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
									var d = R * c;

									d = parseInt(d);

									MM.distance = MM.distance + d;
									// console.log(d);
									// console.log(MM.distance);
									$('#distance-num').html(MM.distance);

									// var flightPlanCoordinates = [lastPin.position,marker.position];
									//
									// var flightPath = new google.maps.Polyline({
									//     path: flightPlanCoordinates,
									//     strokeColor: "#FF0000",
									//     strokeOpacity: 1.0,
									//     strokeWeight: 2
									// 								  	});
									//
									// 								  	flightPath.setMap(map);

								}
								lastPin = marker;

								map.panTo(latLng);
							}

						}

			        }
			    }

			});

			$('#player').html(track.render());
		}

		$('#load').click(function() {
			loadTrack(MM);//.play();
		});
		$('#play').click(function() {
			track.play();
		});
		$('#skip').click(function() {
			track.seek(45);
		});
		$('#end').click(function() {
			track.seek(150);
		});

		$('#pause').click(function() {
			track.pause();
		});

		MM.track.subtitle("b930f210-5172-4f9b-836f-0805f69a7978", function(data) {
			MM.lyrics = data;
			// console.log(MM.lyrics);
			loadTrack(MM);
		});

	});

	var map;
	function initialize() {
		var myOptions = {
			zoom: 5,
			center: new google.maps.LatLng(38.856,-90.628),
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};

		map = new google.maps.Map(document.getElementById('map'), myOptions);

		$.getJSON('america_keyed.json', function(data) {
			// console.log(data);
			MM.places = data;
		});
	}

    google.maps.event.addDomListener(window, 'load', initialize);

</script>

<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=266192196816674";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-323014-32']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
